<div class="driver-container relative h-screen w-full overflow-hidden">
  <app-map class="map absolute inset-0 z-0" [origin]="mapOrigin" [destination]="mapDestination"
    [routeGeometry]="mapRouteGeometry"
    [userLocation]="activeRide ? {lat: activeRide.pickupLat, lng: activeRide.pickupLng} : null"
    (userLocationDetected)="onMapLocationDetected($event)" [showUserMarker]="!!activeRide">
  </app-map>

  <!-- Show active ride overlay when ride is active -->
  <app-driver-active-ride *ngIf="showActiveRide" class="absolute inset-0 z-10 pointer-events-none"
    [activeRide]="activeRide" [driverId]="driverId" (rideCompleted)="onRideCompleted()"
    (rideCancelled)="onRideCancelled()" (mapUpdate)="onMapUpdate($event)">
  </app-driver-active-ride>

  <!-- <div class="top-bar relative z-10" *ngIf="!showActiveRide">
    <div class="wallet">
      <span>VND</span>
      <strong>900.000</strong>
    </div>
    <div class="driver-avatar" (click)="goToProfile()">
      <img [src]="driverAvatar" alt="Driver Avatar" />
    </div>
  </div> -->

  <!-- CENTER MESSAGE -->
  <div class="status-message relative z-10" *ngIf="!isOnline && !showActiveRide">
    Nhแบฅn ฤแป bแบญt/tแบฏt chแบฟ ฤแป<br />
    <b>sแบตn sรng & tแปฑ ฤแปng nhแบญn cuแปc</b>
  </div>

  <button *ngIf="!showActiveRide" class="power-btn relative z-10" [class.online]="isOnline" (click)="toggleOnline()">
    {{ isOnline ? 'ฤang kแบฟt nแปi' : 'Bแบญt kแบฟt nแปi' }}
  </button>
  <div class="status-bar relative z-10" *ngIf="!showActiveRide">
    {{ isOnline ? 'Bแบกn ฤang sแบตn sรng nhแบญn cuแปc.' : 'Bแบกn ฤang khรดng sแบตn sรng nhแบญn cuแปc.' }}
  </div>

  <!-- GPS Debug Panel -->
  <button class="debug-toggle-btn relative z-20" (click)="toggleDebugPanel()" [class.active]="showDebugPanel">
    ๐ฐ๏ธ GPS
  </button>

  <div class="debug-panel relative z-20" *ngIf="showDebugPanel">
    <div class="debug-header">
      <span>๐ก GPS Debug Logs</span>
      <button (click)="toggleDebugPanel()">โ</button>
    </div>
    <div class="debug-content">
      <div *ngIf="debugLogs.length === 0" class="debug-empty">
        Chฦฐa cรณ logs...
      </div>
      <div *ngFor="let log of debugLogs" class="debug-log-item">
        {{ log }}
      </div>
    </div>
  </div>
</div>

<app-driver-notification-modal [isVisible]="showRideRequestModal" [rideRequest]="currentRideRequest"
  (accept$)="onAcceptRide($event)" (reject$)="onRejectRide($event)" (timeout$)="onRideRequestTimeout($event)">
</app-driver-notification-modal>

<app-driver-finished-ride *ngIf="showFinishedRide" [rideInfo]="finishedRideInfo" (close)="onCloseFinishedRide()">
</app-driver-finished-ride>